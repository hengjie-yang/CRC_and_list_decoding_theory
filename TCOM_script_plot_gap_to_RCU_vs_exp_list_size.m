% This script is to generate the SNR gap to the RCU bound vs. E[L] plot for
% CRC-TBCC codes.
%
% Written by Hengjie Yang (hengjie.yang@ucla.edu)   03/11/21
%

clear all;
clc;


set(0,'DefaultTextFontName','Times','DefaultTextFontSize',16,...
    'DefaultAxesFontName','Times','DefaultAxesFontSize',16,...
    'DefaultLineLineWidth',1,'DefaultLineMarkerSize',7.75);
set(groot, 'defaultAxesTickLabelInterpreter','latex'); 
set(groot, 'defaultLegendInterpreter','latex');

% basic parameters
target_prob_UE = 10^(-3);
k = 64;
omega = 2;

vs = [3,4,5,6,7,8,9,10];
fileNames = cell(8, 1);
SNR_gaps = cell(8, 1);
Complexities = cell(8, 1);

path = './TCOM_sim_data/';

% v = 3
fileNames{1} = {'030821_231648_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_13_17_CRC_17_k_64';...
    '030821_224936_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_13_17_CRC_37_k_64';...
    '030821_225951_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_13_17_CRC_55_k_64';...
    '030521_164036_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_13_17_CRC_143_k_64';...
    '030521_195504_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_13_17_CRC_355_k_64';...
    '030621_231558_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_13_17_CRC_407_k_64';...
    '030621_232102_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_13_17_CRC_1511_k_64';...
    '030721_135158_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_13_17_CRC_2235_k_64'};

% v = 4
fileNames{2} = {'030421_115833_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_27_31_CRC_17_k_64';...
    '030821_225400_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_27_31_CRC_21_k_64';...
    '030521_150812_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_27_31_CRC_63_k_64';...
    '030521_164120_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_27_31_CRC_117_k_64';...
    '030521_195547_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_27_31_CRC_265_k_64';...
    '030621_231657_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_27_31_CRC_653_k_64';...
    '030621_232149_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_27_31_CRC_1145_k_64';...
    '030721_135415_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_27_31_CRC_2321_k_64'};


% v = 5
fileNames{3} = {'030421_125256_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_53_75_CRC_11_k_64';...
    '030421_145713_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_53_75_CRC_21_k_64';...
    '030521_150852_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_53_75_CRC_77_k_64';...
    '030521_164220_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_53_75_CRC_143_k_64';...
    '030521_195733_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_53_75_CRC_275_k_64';...
    '030621_231749_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_53_75_CRC_555_k_64';...
    '030621_232232_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_53_75_CRC_1511_k_64';...
    '030721_135503_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_53_75_CRC_2033_k_64'};

% v = 6
fileNames{4} = {'030421_132529_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_133_171_CRC_17_k_64';...
    '030421_190407_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_133_171_CRC_33_k_64';...
    '030521_150949_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_133_171_CRC_75_k_64';...
    '030521_170021_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_133_171_CRC_177_k_64';...
    '030521_204400_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_133_171_CRC_377_k_64';...
    '030621_231914_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_133_171_CRC_505_k_64';...
    '030621_232312_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_133_171_CRC_1275_k_64';...
    '030721_142240_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_133_171_CRC_2561_k_64'};

% v = 7
fileNames{5} = {'030421_171402_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_247_371_CRC_17_k_64';...
    '030421_203611_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_247_371_CRC_21_k_64';...
    '030521_163812_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_247_371_CRC_63_k_64';...
    '030521_194806_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_247_371_CRC_143_k_64';...
    '030621_231334_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_247_371_CRC_357_k_64';...
    '030621_235756_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_247_371_CRC_505_k_64';...
    '030721_134920_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_247_371_CRC_1641_k_64';...
    '031121_174953_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_247_371_CRC_2727_k_64'};

% v = 8
fileNames{6} = {'030521_094115_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_561_753_CRC_17_k_64';...
    '030521_093846_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_561_753_CRC_21_k_64';...
    '030821_211823_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_561_753_CRC_63_k_64';...
    '030821_212438_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_561_753_CRC_177_k_64';...
    '030821_212850_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_561_753_CRC_377_k_64';...
    '030821_213208_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_561_753_CRC_653_k_64';...
    '030921_102214_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_561_753_CRC_1401_k_64';...
    '030521_093946_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_561_753_CRC_2365_k_64'};

% v = 9
fileNames{7} = {'030721_134506_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_1131_1537_CRC_15_k_64';...
    '030821_211235_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_1131_1537_CRC_25_k_64';...
    '030821_212054_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_1131_1537_CRC_63_k_64';...
    '030821_212555_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_1131_1537_CRC_121_k_64';...
    '030821_213015_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_1131_1537_CRC_305_k_64';...
    '030921_101125_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_1131_1537_CRC_777_k_64';...
    '031121_163630_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_1131_1537_CRC_1511_k_64'};

% v = 10
fileNames{8} = {'030821_211518_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_2473_3217_CRC_17_k_64';...
    '030821_210831_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_2473_3217_CRC_33_k_64';...
    '030821_212241_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_2473_3217_CRC_63_k_64';...
    '030821_212713_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_2473_3217_CRC_171_k_64';...
    '030921_100949_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_2473_3217_CRC_273_k_64';...
    '031121_163302_sim_data_probs_and_exp_list_sizes_vs_SNR_TBCC_2473_3217_CRC_631_k_64'};


for iter = 1:length(vs)
    v = vs(iter);
    SNR_gaps{iter} = zeros(size(fileNames{iter}, 1), 1);
    Complexities{iter} = zeros(size(fileNames{iter}, 1), 1);
    for ii = 1:size(fileNames{iter}, 1)
        m = ii + 2;
        n = omega*(k + m);
        R = k / n;
        opt_snr = fzero(@(x) rcu(n, R, [0.5;0.5], [-1;1], 10^(-x/10))-target_prob_UE, [1 3]);
        
        fileName = fileNames{iter}{ii};
        load([path, fileName, '.mat'], 'P_UE_maxs', 'SNRs', 'Exp_list_size_maxs');
        log_SNRs = log10(P_UE_maxs);
        snr_val = interp1(log_SNRs, SNRs, log10(target_prob_UE));
        SNR_gaps{iter}(ii) = snr_val - opt_snr;
        exp_list_rank = interp1(SNRs, Exp_list_size_maxs, snr_val);
        Complexities{iter}(ii) = (k+m)*2^v + 3.5*(k+m)*exp_list_rank;
    end
end

%%
figure;
semilogx(Complexities{1}, SNR_gaps{1}, '+b'); hold on
semilogx(Complexities{2}, SNR_gaps{2}, 'o'); hold on
semilogx(Complexities{3}, SNR_gaps{3}, '*'); hold on
semilogx(Complexities{4}, SNR_gaps{4}, 'x'); hold on
semilogx(Complexities{5}, SNR_gaps{5}, 'v'); hold on
semilogx(Complexities{6}, SNR_gaps{6}, 'd'); hold on
semilogx(Complexities{7}, SNR_gaps{7}, '^'); hold on
semilogx(Complexities{8}, SNR_gaps{8}, 's'); hold on

legend('$\nu=3$ CRC-TBCC',...
    '$\nu=4$ CRC-TBCC',...
    '$\nu=5$ CRC-TBCC',...
    '$\nu=6$ CRC-TBCC',...
    '$\nu=7$ CRC-TBCC',...
    '$\nu=8$ CRC-TBCC',...
    '$\nu=9$ CRC-TBCC',...
    '$\nu=10$ CRC-TBCC',...
    'Location','northeast');

grid on
xlabel('Complexity', 'interpreter', 'latex');
ylabel('Gap to the RCU bound (dB)', 'interpreter', 'latex');


